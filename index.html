<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>Content Dashboard V3 ‚Äî Notion Style</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
    body {
        font-family: Inter, sans-serif;
        background: #f6f6f6;
        margin: 0;
        padding: 20px;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    .title {
        font-size: 24px;
        font-weight: 700;
    }

    .filters button {
        border: 1px solid #ddd;
        background: white;
        padding: 6px 12px;
        border-radius: 20px;
        margin-right: 6px;
        cursor: pointer;
    }

    .filters button.active {
        background: #2563eb;
        color: white;
        border-color: #2563eb;
    }

    .card {
        background: white;
        padding: 18px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        margin-bottom: 28px;
        border-left: 6px solid #e5e7eb;
    }

    .platform-facebook { border-left-color: #1877f2; }
    .platform-instagram { border-left-color: #d62976; }
    .platform-tiktok { border-left-color: #000; }

    .media-preview {
        margin: 12px 0;
        border-radius: 10px;
        max-width: 260px;
        overflow: hidden;
        background: #f1f1f1;
    }

    .media-preview img, .media-preview video {
        width: 100%;
        border-radius: 10px;
    }

    .caption-box {
        width: 100%;
        min-height: 120px;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-size: 14px;
    }

    .btn {
        padding: 8px 16px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        margin-right: 6px;
    }
    .btn-edit { background: #e5e7eb; }
    .btn-update { background: #2563eb; color: white; }
    .btn-rewrite { background: #16a34a; color: white; }

</style>
</head>

<body>

<div class="header">
    <div class="title">üìò Content Dashboard V3 ‚Äî Notion Style</div>
    <button class="btn" onclick="loadPosts()">üîÑ Refresh</button>
</div>

<div class="filters">
    <button class="active" onclick="filterPlatform('all')">T·∫•t c·∫£</button>
    <button onclick="filterPlatform('Facebook')">Facebook</button>
    <button onclick="filterPlatform('Instagram')">Instagram</button>
    <button onclick="filterPlatform('Tiktok')">Tiktok</button>
</div>

<div id="postsContainer"></div>

<script defer>
console.log("Dashboard script loaded.");

const API_URL = "https://pfktja.ezn8n.com/webhook/api/posts";

async function loadPosts() {
    console.log("Fetching posts‚Ä¶");

    try {
        const res = await fetch(API_URL);
        const data = await res.json();

        console.log("API Response:", data);

        if (!data.posts || data.posts.length === 0) {
            document.getElementById("postsContainer").innerHTML =
                "<p>Kh√¥ng c√≥ b√†i vi·∫øt h√¥m nay.</p>";
            return;
        }

        renderPosts(data.posts);

    } catch (err) {
        console.error("Fetch error:", err);
        document.getElementById("postsContainer").innerHTML =
            "<p style='color:red'>L·ªói t·∫£i d·ªØ li·ªáu API</p>";
    }
}

function renderPosts(posts) {
    const container = document.getElementById("postsContainer");
    container.innerHTML = "";

    posts.forEach(post => {
        const div = document.createElement("div");
        div.className = `card platform-${post.platform.toLowerCase()}`;

        div.innerHTML = `
            <h3>#${post.post_id} ‚Äî ${post.title}</h3>
            <div><b>Page:</b> ${post.page} ‚Äî <b>${post.platform}</b></div>
            <div><b>Ng√†y:</b> ${post.plan_date} ‚Äî <b>Gi·ªù:</b> ${post.plan_time}</div>

            <div class="media-preview">
                ${post.media_url ? `<img src="${post.media_url}" />` : "Kh√¥ng c√≥ media"}
            </div>

            <b>Caption</b>
            <textarea class="caption-box" id="cap_${post.post_id}">${post.caption || ""}</textarea>

            <br><br>

            <button class="btn btn-edit" onclick="editPost(${post.post_id})">‚úèÔ∏è Edit</button>
            <button class="btn btn-rewrite" onclick="rewrite(${post.post_id})">‚ú® Rewrite</button>
            <button class="btn btn-update" onclick="updatePost(${post.post_id})">üíæ L∆∞u & C·∫≠p nh·∫≠t</button>
        `;

        container.appendChild(div);
    });
}

function filterPlatform(platform) {
    document.querySelectorAll(".filters button").forEach(btn => btn.classList.remove("active"));
    event.target.classList.add("active");

    const cards = document.querySelectorAll(".card");
    cards.forEach(c => {
        if (platform === "all") return (c.style.display = "block");
        c.style.display = c.classList.contains(`platform-${platform.toLowerCase()}`) ? "block" : "none";
    });
}

loadPosts();
</script>

</body>
</html>
